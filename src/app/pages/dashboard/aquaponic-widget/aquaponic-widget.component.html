<nb-card>
  <nb-card-header>
    <div class="input-group" *ngIf="!editing">
      <div class="dropdown input-group-btn" ngbDropdown>
        <button type="button" class="btn btn-success dropdown-toggle" ngbDropdownToggle>
          Action
        </button>
        <ul class="dropdown-menu" ngbDropdownMenu>
          <li class="dropdown-item" (click)="addLevelsModal()">Add level readings</li>
          <li class="dropdown-item" (click)="addComponentModal()">Edit System</li>
          <li class="dropdown-item" (click)="changeChartDetails()">Change chart details</li>
        </ul>
      </div>
      <span class="form-control">{{system.name}}</span>
    </div>
    <div class="input-group" *ngIf="editing">
      <span class="input-group-btn">
        <button class="btn btn-success" (click)="changeChartDetails()">
          Save
        </button>
      </span>
      <select class="form-control" (change)="organismChange($event.target.value)">
        <option
          *ngFor="let o of systemOrganisms"
          [selected]="o.id == selectedOrganism.id"
        >
          {{o.name}}
        </option>
      </select>
      <select class="form-control" (change)="levelTypeChange($event.target.value)">
        <option
          *ngFor="let lt of levelTypeKeys()"
          [selected]="lt == selectedLevelType"
        >
          {{lt}}
        </option>
      </select>
    </div>

  </nb-card-header>
  <nb-card-body [ngBusy]="loadChartBusy">
    <p class="alert alert-danger text-center" role="alert" *ngIf="!suitableForOrganism">
      A {{selectedLevelType}} level of {{latestReading.value}} is not suitable for {{selectedOrganism.name}}
    </p>
    <p class="text-center">{{selectedOrganism.name}} vs {{selectedLevelType}}</p>

    <ngx-levels-chart
      [selectedLevelType]="selectedLevelType"
      [selectedOrganism]="selectedOrganism"
      [loadChartBusy]="loadChartBusy"
      [system]="system"
      [latestReading]="latestReading"
      [suitableForOrganism]="suitableForOrganism"></ngx-levels-chart>
  </nb-card-body>
</nb-card>


